url:
  protocol:                null
  domain:                  null
  path:                    /
  base:                    ${url.protocol}${url.domain}${url.path}

paths:
  storage:                 ${paths.site}/storage

templates:
  paths:
    core:                  ${paths.core}/templates
    site:                  ${paths.site}/templates
  twigconfig:
    cache:                 ${paths.cache}/twig
    auto_reload:           true
  css:
    digraph_core:          ${url.base}digraph/core.css
    fontawesome:           ${url.base}fontawesome/css/all.min.css
  cssbundles:
    digraph_core:
      hypersemantic:       digraph/hypersemantic/bundle.css
      core_navigation:     digraph/core/navigation.css
      core_notifications:  digraph/core/notifications.css
      core_forms:          digraph/core/forms.css
    hypersemantic:
      typography:          digraph/hypersemantic/typography.css
      menus:               digraph/hypersemantic/menus.css
      linkicons:           digraph/hypersemantic/linkicons.css
      layout:              digraph/hypersemantic/layout-1col.css
  js:
    head:                  []
    foot:                  []
  jsbundles:               []

routing:
  paths:
    site:                  ${paths.site}/routes

modules:
  paths:
    core:                  ${paths.core}/modules
    site:                  ${paths.site}/modules

users:
  namespacing:
    # possible values for users.namespacing.mode
    # auth:                one namespace for public, one for authenticated users
    # id:                  full user ID, which is guaranteed to be unique
    # username:            just the username portion, which *should* all be the same person via different auth methods
    # groups:              namespaced based on full list of groups users belong to, groups can be ignored by adding them to users.namespacing.ignore
    mode:                  groups

permissions:
  url:
    '*':
      - deny all
    '*/display':
      - allow all
  action:
    '*':
      - deny all

navigation:
  menus:
    main:                  from:home

fullmunge:
  - build
  - error
  - template
  - finalize
  - render

mungers:
  # Constructs the content of a URL, based on initial URL and current user
  build:
    # Initializes namespace based on current user and users.namespacing config
    100-userinitialize:    Digraph\Users\UserMunger
    # Loads package defaults and builds the hash
    110-initialize:        Digraph\Mungers\Build\Initialize
    # Checks for mediahelper hits on the current url
    200-media:             Digraph\Media\MediaMunger
    # Resolves slugs and identifies the object that is being referenced, if any
    # This is also where 300 pages are triggered, if slugs resolve to multiple pages
    # This is also where redirects are triggered for normalizing URLs
    300-locate:            Digraph\Mungers\Build\Locate
    # Tries to match verb/noun to a route handler file
    # this is where 404 errors originate
    400-route:             Digraph\Mungers\Build\Route
    # Checks permissions, throws 403 errors
    500-permissions:       Digraph\Permissions\PermissionsMunger
    # Executes handler files and puts their output into the package
    600-execute:           Digraph\Mungers\Build\Execute
  # Builds content of error pages if status isn't 200
  error:
    # Builds error pages based on status
    # uses @error route folder, but doesn't use the same environment as Execute
    # TODO Error may be able to extend the execute munger, which would make it
    # present the same environment to handler files
    100-error:             Digraph\Mungers\Error\Error
  # Applies templates
  template:
    # Applies templates based on package.response.template and package.fields
    100-templates:         Digraph\Templates\TemplateMunger
  # Any final preparation before output
  finalize:
    # Builds HTTP headers, but doesn't output them, saves them in response.headers
    100-headers:           Digraph\Mungers\Finalize\Headers
  # Outputs package to the browser
  render:
    # Outputs headers from response.headers
    100-headers:           Digraph\Mungers\Render\Headers
    # Outputs with readfile() if response.readfile is set, otherwise just echoes
    # response.content
    200-output:            Digraph\Mungers\Render\Output

helpers:
  classes:
    urls:                  Digraph\Urls\UrlHelper
    modules:               Digraph\Helpers\Modules
    routing:               Digraph\Helpers\Routing
    forms:                 Digraph\Forms\FormHelper
    templates:             Digraph\Templates\TemplateHelper
    notifications:         Digraph\Templates\NotificationsHelper
    navigation:            Digraph\Templates\NavigationHelper
    media:                 Digraph\Media\MediaHelper
    permissions:           Digraph\Permissions\PermissionsHelper
    session:               Digraph\Helpers\Session
    users:                 Digraph\Users\UserHelper

forms:
  defaultmap:
    digraph_name:
      field:               digraph.name
      label:               Display name
      class:               Formward\Fields\Input
      required:            true
    digraph_title:
      field:               digraph.title
      label:               Display title
      class:               Formward\Fields\Input
    digraph_slug:
      field:               digraph.slug
      label:               Url Slug
      class:               Digraph\Forms\Fields\Slug
    digraph_body:
      field:               digraph.body
      label:               Body content
      class:               Formward\Fields\Textarea

noun:
  types:                   []
  defaults:                []

mungerhooks:
  build:                   []
  render:                  []

media:
  paths:
    digraph_core:          ${paths.core}/media

cache:
  mungercache:
    adapter:               default
    threshold:             100 #ms
  factorycache:
    adapter:               default
    threshold:             5 #ms
  adapters:
    default:
      items:
        class:             \Symfony\Component\Cache\Adapter\FilesystemAdapter
        args:
          namespace:       'default'
          defaultlifetime: 60
          directory:       ${paths.cache}/defaultcache
      tags:                null

package:
  defaults:
    fields:
      page_title:          ${page_name}
      page_name:           Untitled
    request:
      namespace:           public
    response:
      status:              200
      ttl:                 60
      cacheable:           true
      content:             ''
      ready:               false
      mime:                text/html
      charset:             utf-8
      disposition:         inline
      template:            default

# bootstrap settings are used by the Bootstrapper class, and are then removed
# from the config used in the created CMS. This is a nice secure way to handle
# setting up drivers and factories, and you should use it if at all possible.
bootstrap:
  drivers:
    default:
      credentials:         driver
  factories:
    content:
      class:               \Digraph\DSO\ContentFactory
      driver:              default
      table:               digraph_content
    system:
      class:               \Destructr\Factory
      driver:              default
      table:               digraph_system
